<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bike Hazard Simulation â€” Accident Stop (Full)</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:Arial,Helvetica,sans-serif;background:#9ad0ff}

  /* SCENE: sky + fields (flat, no buildings) */
  .scene{
    position:relative;
    width:100%;
    height:100vh;
    overflow:hidden;
    background: linear-gradient(#82c7ff 0%, #bfe5ff 56%, #cbe8a0 56%, #9ec55a 72%);
  }

  /* FLAT ROAD (asphalt strip at bottom) */
  .road {
    position:absolute;
    left:0; right:0; bottom:0;
    height:32%;
    background: #5b5b5b;
    border-top: 8px solid #a0a0a0;
    z-index: 10;
  }

  /* CENTER DASHED LINE (horizontal across road) */
  .center-line {
    position:absolute;
    top:45%;
    left:0; right:0;
    height:6px;
    background: repeating-linear-gradient(
      to right,
      #ffd54f 0 60px,
      transparent 60px 120px
    );
    opacity:0.95;
  }

  /* ROAD BOTTOM EDGE (solid white) */
  .bottom-edge {
    position:absolute;
    left:0; right:0; bottom:0;
    height:7px;
    background:white;
    opacity:0.9;
  }

  /* UI: message and controls */
  .message{
    position:absolute; top:16px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,0.85); color:#fff; padding:10px 18px; border-radius:10px; font-weight:700; z-index:400;
  }
  .accident-warning{
    position:absolute; top:2px; right:20px;
    background:#e53935; color:#fff; padding:10px 16px; border-radius:8px; border:3px solid #fff; display:none; z-index:400;
  }
  .accident-warning.show{display:block;}

  .controls {
    position:absolute; left:18px; top:76px; width:230px; background:#fff; padding:12px; border-radius:10px;
    box-shadow:0 8px 30px rgba(0,0,0,0.12); z-index:400;
  }
  .controls button {
    display:block; width:100%; padding:10px; border-radius:8px; border:0; margin-top:8px; background:#1976d2; color:#fff; font-weight:700; cursor:pointer;
  }
  .controls button:disabled { background:#9aa7c0; cursor:not-allowed; }

  /* ACCIDENT IMAGE */
  .accident {
    position:absolute;
    width:550px;
    height:auto;
    bottom:0%;
    right:-5%;
    transform: translateX(0);
    z-index:200;
    pointer-events:none;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,0.3));
  }

  /* Bikes */
  /* .bike {
    position:absolute;
    width:250px;
    height:auto;
    bottom:20%;
    transition:left 0.05s linear;
    z-index:220;
    filter: drop-shadow(0 6px 6px rgba(0,0,0,0.35));
  }
  .bike img { width:100%; height:auto; display:block; margin-left:-6px; } */
  .bike {
  position: absolute;
  width: 350px;        /* increased from 150px â†’ 210px (+40%) */
  height: auto;
  bottom: 10%;
  transition: left 0.01s linear;
  z-index: 220;
  filter: drop-shadow(0 6px 6px rgba(0,0,0,0.35));
}

.bike img {
  width: 100%;
  height: auto;
  display: block;
  margin-left: -10px;  /* adjust for larger size */
}


  /* HAZARD SYMBOL (blinking triangle) */
  @keyframes hazardBlink {
    0%  { opacity: 1; transform: translateX(-50%) scale(1); }
    50% { opacity: 0.25; transform: translateX(-50%) scale(1.15); }
    100%{ opacity: 1; transform: translateX(-50%) scale(1); }
  }

  .hazard-symbol {
    position:absolute;
    top:10px;
    left:43%;
    transform:translateX(-50%);
    font-size:36px;
    line-height:1;
    color:#ffcc00;
    text-shadow: 0 0 8px rgba(0,0,0,0.6);
    display:none;
    z-index:300;
    animation: hazardBlink 0.7s infinite;
    pointer-events:none;
  }

  .stopped { opacity:0.95; }

  /* responsiveness */
  @media (max-width:900px){
    .bike { width:120px; bottom:18% }
    .road { height:38% }
    .accident { width:160px; bottom:16%; right:16% }
    .hazard-symbol { font-size:28px; top:-48px }
  }
</style>
</head>
<body>
  <div class="scene">
    <div id="msg" class="message">ðŸš´ Lead bike will detect accident ahead!</div>
    <div id="accWarn" class="accident-warning">âš  ACCIDENT AHEAD âš </div>

    <div class="controls">
      <button id="startBtn">Start Simulation</button>
      <button id="resetBtn">Reset</button>
      <button id="homePageBtn">Home Page</button>
      <div style="margin-top:10px;font-weight:700">Stats:</div>
      <div>Total Bikes: <span id="tB">5</span></div>
      <div>Warned: <span id="wB">0</span></div>
    </div>

    <!-- road band -->
    <div class="road">
      <div class="center-line"></div>
      <div class="bottom-edge"></div>
    </div>

    <!-- accident image (replaces barrier) -->
    <img id="accident" class="accident" src="acc1.png" alt="accident">

  </div>

<script>
/* local bike image path (uploaded earlier) */
const BIKE_IMG = "bt.png";

/* per-bike speeds (pixels per frame update) */
const speeds = [4.5, 3.2, 3.0, 2.8, 2.6];

let bikes = [];
let running = false;
let raf;

const scene = document.querySelector('.scene');
const msg = document.getElementById('msg');
const accWarn = document.getElementById('accWarn');
const accident = document.getElementById('accident');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');

function createBike(i) {
  const div = document.createElement('div');
  div.className = 'bike';
  // start each bike off-screen to left
  div.style.left = (-130 - i * 130) + 'px';
  div.innerHTML = `
    <img src="${BIKE_IMG}" alt="bike">
    <div class="hazard-symbol">âš </div>
  `;
  scene.appendChild(div);

  return {
    el: div,
    pos: -130 - i * 130,
    speed: speeds[i] || 3,
    warned: false,
    stopped: false
  };
}
document.getElementById("homePageBtn").addEventListener("click", function () {
    window.location.href = "index.html";
});

function init() {
  // remove existing bike elements
  document.querySelectorAll('.bike').forEach(n => n.remove());
  bikes = [];
  accWarn.classList.remove('show');
  msg.textContent = 'ðŸš´ Lead bike will detect accident ahead!';
  document.getElementById('wB').textContent = 0;

  for (let i = 0; i < 5; i++) {
    bikes.push(createBike(i));
  }
  document.getElementById('tB').textContent = bikes.length;
}

/* show/hide hazard symbol for a bike object */
function showHazard(bikeObj) {
  const s = bikeObj.el.querySelector('.hazard-symbol');
  if (s) s.style.display = 'block';
}
function hideHazard(bikeObj) {
  const s = bikeObj.el.querySelector('.hazard-symbol');
  if (s) s.style.display = 'none';
}

/* update warned count UI */
function updateWarnCount() {
  const warned = bikes.filter(b => b.warned).length;
  document.getElementById('wB').textContent = warned;
}

/* MAIN animation loop */
function animate() {
  if (!running) return;

  const accRect = accident.getBoundingClientRect();
  const accX = accRect.left; // we'll use left edge as reference

  let allStopped = true;

  bikes.forEach((b, i) => {
    // if already stopped, do nothing
    if (b.stopped) return;
    allStopped = false;

    // move forward if not warned
    if (!b.warned) {
      b.pos += b.speed;
      b.el.style.left = b.pos + 'px';
    }

    // LEAD BIKE detection: trigger warning when close enough
    if (i === 0 && !b.warned && b.pos >= accX - 260) {
      b.warned = true;

      // lead shows hazard immediately while still moving
      showHazard(b);
      accWarn.classList.add('show');
      msg.textContent = 'âš  Lead bike detected accident â€” Alerting others!';

      // Immediately stop the lead bike at its current position (no drift)
      b.stopped = true;
      b.el.classList.add('stopped');
      b.el.style.left = b.pos + 'px';

      // Warn others: they should stop instantly at current positions
      setTimeout(() => {
        bikes.forEach((other, j) => {
          if (j === 0) return;
          // mark warned, show hazard and freeze in place immediately
          other.warned = true;
          showHazard(other);
          other.stopped = true;
          other.el.classList.add('stopped');
          // ensure style left equals current pos (freeze)
          other.el.style.left = other.pos + 'px';
        });
        updateWarnCount();
        msg.textContent = 'ðŸš¨ Other bikes warned â€” all bikes stopped!';
      }, 250); // small delay so lead hazard is visible first
    }

    // In-case any following bike is flagged warned earlier (defensive)
    if (i !== 0 && b.warned && !b.stopped) {
      // Freeze immediately at current position
      b.stopped = true;
      b.el.classList.add('stopped');
      b.el.style.left = b.pos + 'px';
      showHazard(b);
      updateWarnCount();
    }
  });

  if (allStopped) {
    running = false;
    startBtn.disabled = false;
    msg.textContent = 'âœ… All bikes stopped safely at their positions.';
    return;
  }

  raf = requestAnimationFrame(animate);
}

/* Controls */
startBtn.addEventListener('click', () => {
  if (running) return;
  // hide any previous hazards
  bikes.forEach(b => hideHazard(b));
  running = true;
  startBtn.disabled = true;
  animate();
});

resetBtn.addEventListener('click', () => {
  running = false;
  cancelAnimationFrame(raf);
  startBtn.disabled = false;
  init();
});

/* initial setup */
init();
</script>
</body>
</html>
